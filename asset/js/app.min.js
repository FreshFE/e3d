!function(){window.StageView=Backbone.View.extend({el:"#stage",tiles:null,model:null,initialize:function(){var t=this;$(window).resize(function(){t.changeStageSize()})},start:function(t){var e=this;return $.get("cases/"+t+".json",function(t){e.model=t,e.changeStageSize();var n="";$.each(t.tiles,function(t,i){n+=e.buildHtml(i)}),e.render(n),e.changeLogo(),e.tilesSlideIn(),e.onClickEvent()}),this},buildHtml:function(t){var e="",n="";return"fancybox"===t.type?(e=' class="fancybox"',n=t.link):"external"===t.type?(e=' class="external" target="_blank"',n=t.link):n="#slide/"+t.link,Modernizr.csstransforms?'<div class="tile" style="width: '+t.width+"px; height: "+t.height+"px; top: "+t.y+"px; left: "+t.x+'px;"><a href="'+n+'" title="'+t.title+'"'+e+'><img src="cases/'+t.img+'"></a></div>':'<div class="tile" data-top="'+t.y+'" style="width: '+t.width+"px; height: "+t.height+"px; top: -1000px; left: "+t.x+'px;"><a href="'+n+'" title="'+t.title+'"'+e+'><img src="cases/'+t.img+'"></a></div>'},render:function(t){return this.tiles=$(t).appendTo($("#tiles")),this},changeLogo:function(){return $("#logo").html(this.model.name),this},changeStageSize:function(){var t=$(window).width(),e=$(window).height(),n=Math.floor((t-this.model.width)/2),i=Math.floor((e-this.model.height)/2);return 80>i&&(i=80),this.$el.css({left:n,top:i,width:this.model.width,height:this.model.height}),$(".tiles",this.$el).css({width:this.model.width,height:this.model.height}),this},tilesSlideIn:function(){return this.tiles.each(function(t,e){timeout=20*Math.floor(30*Math.random()),setTimeout(function(){if(Modernizr.csstransforms)$(e).transition({y:0},300,"snap");else{var t=$(e);t.transition({top:t.data("top")},300,"snap")}},timeout)}),document.getElementById("audio-flewin").play(),this},tilesSlideOut:function(){return this.tiles.each(function(t,e){timeout=20*Math.floor(30*Math.random()),setTimeout(function(){if(Modernizr.csstransforms)$(e).transition({y:-1500});else{var t=$(e);t.transition({top:-1500})}},timeout)}),this},onClickEvent:function(){$(".fancybox",this.tiles).on("click",function(t){t.preventDefault();var e=$(this).attr("href");$.get("cases/"+e+".json",function(t){var e=$('<div class="fancybox-new-nav fancybox-new-nav-prev"></div>'),n=$('<div class="fancybox-new-nav fancybox-new-nav-next"></div>'),i=function(){var t=$(window).height();$(".fancybox-image").width();var i=$(".fancybox-wrap").width(),o=$(".fancybox-wrap").offset().left;e.css({top:(t-100)/2,left:o-70}),n.css({top:(t-100)/2,left:o+i+10})},o={type:"image",openEffect:"none",closeEffect:"none",nextEffect:"none",prevEffect:"none",padding:0,margin:100,afterShow:function(){e.appendTo($(".fancybox-overlay")).on("click",function(){$.fancybox.prev()}),n.appendTo($(".fancybox-overlay")).on("click",function(){$.fancybox.next()}),"ontouchstart"in document.documentElement?$(".fancybox-image").on("click",function(){$(".fancybox-close").fadeToggle()}):$(".fancybox-wrap").hover(function(){$(".fancybox-close").fadeIn()},function(){$(".fancybox-close").hide()}),i()},onUpdate:function(){i()}};$.fancybox(t,o)})})},end:function(t){var e=this;return this.tilesSlideOut(),setTimeout(function(){e.tiles.remove(),t.call()},2e3),this}})}(),$(document).ready(function(){var t=window.StageView,e=null,n=Backbone.Router.extend({routes:{"":"home","slide/:folder":"slide"},home:function(){this.slide("main")},slide:function(n){null!==e?e.end(function(){e=null,e=new t,e.start(n)}):(e=new t,e.start(n))}});new n,Backbone.history.start()}),$(document).ready(function(){var t=document.getElementById("audio-background");setTimeout(function(){t.play()},3e3),$("#audio-background-switch").on("click",function(e){e.preventDefault(),t.paused?(t.play(),$(this).removeClass("close")):(t.pause(),$(this).addClass("close"))})});